<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=2"><meta name=theme-color content=#222><meta name=generator content="Hexo 4.2.0"><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-next.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32-next.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16-next.png><link rel=mask-icon href=/images/logo.svg color=#222><meta name=msvalidate.01 content=true><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><link rel=stylesheet href=//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css><script id=hexo-configurations>
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pdxblog.top","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"b2t":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":{"enable":true,"onlypost":false,"loadingImg":null},"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script><meta name=description content=架构><meta property=og:type content=article><meta property=og:title content=Apache之FCGI模式部署LAMP><meta property=og:url content=https://pdxblog.top/Apache%E4%B9%8BFCGI%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2LAMP.html><meta property=og:site_name content=Maisyの博客><meta property=og:description content=架构><meta property=og:locale content=zh_CN><meta property=og:image content="https://img-blog.csdnimg.cn/20200610184252757.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><meta property=og:image content="https://img-blog.csdnimg.cn/20200610184525405.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><meta property=og:image content=https://img-blog.csdnimg.cn/20200610184606798.png><meta property=og:image content="https://img-blog.csdnimg.cn/20200610184657790.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><meta property=og:image content="https://img-blog.csdnimg.cn/20200610184715159.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><meta property=og:image content="https://img-blog.csdnimg.cn/20200610184748849.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><meta property=og:image content="https://img-blog.csdnimg.cn/20200610184803971.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><meta property=og:image content="https://img-blog.csdnimg.cn/20200610184819127.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><meta property=og:image content="https://img-blog.csdnimg.cn/20200610184950613.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><meta property=article:published_time content=2020-06-09T16:00:00.000Z><meta property=article:modified_time content=2020-06-10T10:56:08.038Z><meta property=article:author content=Maisy><meta property=article:tag content=架构><meta name=twitter:card content=summary><meta name=twitter:image content="https://img-blog.csdnimg.cn/20200610184252757.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><link rel=canonical href=https://pdxblog.top/Apache%E4%B9%8BFCGI%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2LAMP.html><script id=page-configurations>
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script><title>Apache之FCGI模式部署LAMP | Maisyの博客</title><noscript><style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style></noscript><link rel=alternate href=/atom.xml title=Maisyの博客 type=application/atom+xml></head><body itemscope itemtype=http://schema.org/WebPage><div class="container use-motion"><div class=headband></div><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class=site-meta><a href="/" class=brand rel=start><span class=logo-line-before><i></i></span><h1 class=site-title>Maisyの博客</h1><span class=logo-line-after><i></i></span></a><p class=site-subtitle itemprop=description>记录生活中的点点滴滴</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul id=menu class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel=section><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-top"><a href="/top/" rel=section><i class="fa fa-signal fa-fw"></i>排行榜</a></li><li class="menu-item menu-item-about"><a href="/about/" rel=section><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel=section><i class="fa fa-tags fa-fw"></i>标签<span class=badge>6</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel=section><i class="fa fa-th fa-fw"></i>分类<span class=badge>6</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel=section><i class="fa fa-archive fa-fw"></i>归档<span class=badge>58</span></a></li></ul></nav></div></header><div class=back-to-top><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class=main><div class=main-inner><div class=content-wrap><div class="content post posts-expand"><article itemscope itemtype=http://schema.org/Article class=post-block lang=zh-CN><link itemprop=mainEntityOfPage href=https://pdxblog.top/Apache%E4%B9%8BFCGI%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2LAMP.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/author.jpg><meta itemprop=name content=Maisy><meta itemprop=description content=人的一生就是一个储蓄的过程，在奋斗的时候储存了希望；在耕耘的时候储存了一粒种子；在旅行的时候储存了风景；在微笑的时候储存了快乐。聪明的人善于储蓄，在漫长而短暂的人生旅途中，学会储蓄每一个闪光的瞬间，然后用它们酿成一杯美好的回忆，在四季的变幻与交替之间，散发浓香，珍藏一生></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=Maisyの博客></span><header class=post-header><h1 class=post-title itemprop="name headline">Apache之FCGI模式部署LAMP</h1><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2020-06-10 00:00:00 / 修改时间：18:56:08" itemprop="dateCreated datePublished" datetime=2020-06-10T00:00:00+08:00>2020-06-10</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop=url rel=index><span itemprop=name>架构</span></a></span></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-comment"></i></span> <span class=post-meta-item-text>Valine：</span> <a title=valine href=/Apache%E4%B9%8BFCGI%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2LAMP.html#valine-comments itemprop=discussionUrl><span class="post-comments-count valine-comment-count" data-xid=/Apache%E4%B9%8BFCGI%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2LAMP.html itemprop=commentCount></span></a></span><br><span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>17k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>15 分钟</span></span><div class=post-description>架构</div></div></header><div class=post-body itemprop=articleBody><h3 id=FCGI模式编译安装-LAMP-xcache><a class=header-anchor href=#FCGI模式编译安装-LAMP-xcache>¶</a>FCGI模式编译安装 LAMP+xcache</h3><p>php 的工作模式：</p><blockquote><p>php 在 lamp 环境下共有三种工作模式：CGI 模式、apache 模块、FastCGI 模式。CGI 模式下 运行 PHP，性能不是很好。作为 apache 的模块方式运行，在以前编译安装 lamp 已 经介绍过了。FastCGI 的方式和 apache 模块的不同点在于：FastCGI 方式 PHP 是一处独立的 进程，所有 PHP 子进程都由 PHP 的一个叫作 php-fpm 的组件负责管理；而 apache 模块化方 式运行的 PHP，则是 apache 负责调用 PHP 完成工作。PHP 的 FastCGI 方式性能要比 apache 模块化方式强很多，今天我们以 FastCGI 方式编译安装 lamp</p></blockquote><p>FastCGI 工作机制：</p><blockquote><p>首先客户端发起请求，请求分为 2 种，一种是静态请求它可以直接由 Apache 直接响应返回； 另一种是动态的请求，如其中包含中 php 或者 Perl 这种脚本解释性语言，则由 Apache 服务 器通过 fastcgi 协议调用 php 服务器执行并返回给Apache由 Apache返回解释执行后的结果， 如果这个过程中涉及到对数据的操作，此时 php 服务器还会还会通过 mysql 协议调用 mysql 服务器<br><img data-src="https://img-blog.csdnimg.cn/20200610184252757.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"></p></blockquote><p>编译环境及各软件版本：</p><table><thead><tr><th>Linux</th><th>Web服务器</th><th>PHP</th><th>Mysql数据库</th><th>xcache</th></tr></thead><tbody><tr><td><strong>Centos7.5</strong></td><td><strong>Httpd-2.4.23</strong></td><td><strong>php-5.6.27</strong></td><td><strong>Mysql5.7</strong></td><td><strong>xcache-3.1.0</strong></td></tr></tbody></table><p>本文用到的<a href=https://pan.baidu.com/s/1b6dvnukVS0BBnP4Y-aeBrg target=_blank rel=noopener>软件连接</a></p><p>提取码：vzsu</p><p>主机规划</p><p>至少 3 台主机，操作系统都是 centos7.5.网段在 192.168.1.0/24 网关 192.168.1.250</p><p>分配如下：</p><p>1台httpd服务器（192.168.1.70）</p><p>1台php服务器（192.168.1.50）</p><p>1台mysql服务器（192.168.1.40）</p><h4 id=一、编译安装-LAMP><a class=header-anchor href=#一、编译安装-LAMP>¶</a>一、编译安装 LAMP</h4><p>编译安装 apache(请参考前面 <a href=https://blog.csdn.net/weixin_45636702/article/details/106614543 target=_blank rel=noopener>apache 的安装</a>）</p><p>MySQL直接使用脚本意一键安装</p><h5 id=FastCGI-方式安装-php><a class=header-anchor href=#FastCGI-方式安装-php>¶</a>FastCGI 方式安装 php</h5><h6 id=1、解决依赖关系><a class=header-anchor href=#1、解决依赖关系>¶</a>1、解决依赖关系</h6><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># yum -y install libxml2-devel lzip2-devel libcurl-devel libmcrypt-devel openssl-devel bzip2-devel</span></span><br></pre></td></tr></table></figure><p>安装libmcrypt</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># tar zxf libmcrypt-2.5.7.tar.gz </span></span><br><span class=line>[root@phpserver ~]<span class=comment># cd libmcrypt-2.5.7/</span></span><br><span class=line>[root@phpserver libmcrypt-2.5.7]<span class=comment># ./configure --prefix=/usr/local/libmcrypt &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h6 id=2、编译安装php><a class=header-anchor href=#2、编译安装php>¶</a>2、编译安装php</h6><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># tar zxf php-5.6.27.tar.gz</span></span><br><span class=line>[root@phpserver ~]<span class=comment># cd  php-5.6.27/</span></span><br><span class=line>[root@phpserver php-5.6.27]<span class=comment># ./configure --prefix=/usr/local/php5.6 --with-mysql=mysqlnd \</span></span><br><span class=line>&gt;  --with-pdo-mysql=mysqlnd --with-mysqli=mysqlnd --with-openssl --<span class=built_in>enable</span>-fpm \</span><br><span class=line>&gt;  --<span class=built_in>enable</span>-sockets --<span class=built_in>enable</span>-sysvshm --<span class=built_in>enable</span>-mbstring --with-freetype-dir --with-jpeg-dir \</span><br><span class=line>&gt;  --with-png-dir --with-zlib --with-libxml-dir=/usr --<span class=built_in>enable</span>-xml --with-mhash \</span><br><span class=line>&gt;  --with-mcrypt=/usr/<span class=built_in>local</span>/libmcrypt --with-config-file-path=/etc \</span><br><span class=line>&gt;  --with-config-file-scan-dir=/etc/php.d --with-bz2--<span class=built_in>enable</span>-maintainer-zts</span><br><span class=line>[root@phpserver php-5.6.27]<span class=comment># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><p>相关选项解释：</p><figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br></pre></td><td class=code><pre><span class=line>--prefix=/usr/local/php5.6：安装位置</span><br><span class=line></span><br><span class=line>--with-mysql=mysqlnd：支持 mysql</span><br><span class=line></span><br><span class=line>--with-pdo-mysql=mysqlnd：支持 pdo 模块</span><br><span class=line></span><br><span class=line>--with-mysqli=mysqlnd：支持 mysqli 模块</span><br><span class=line></span><br><span class=line>注：上面的三选项的作用：数据库与 php 不在一个服务器上，指定此种方式，安装数据库 连接驱动</span><br><span class=line></span><br><span class=line>--with-openssl：支持 openssl 模块</span><br><span class=line></span><br><span class=line>--enable-fpm：支持 fpm 模式</span><br><span class=line></span><br><span class=line>--enable-sockets：启用 socket 支持</span><br><span class=line></span><br><span class=line>--enable-sysvshm：启用系统共享内存支持</span><br><span class=line></span><br><span class=line>--enable-mbstring：多字节字串、像我们的中文就是多字节字串</span><br><span class=line></span><br><span class=line>--with-freetype-dir：支持 freetype、就要装 freetype-devel、跟字体相关的、字体解析工具</span><br><span class=line></span><br><span class=line>--with-jpeg-dir</span><br><span class=line></span><br><span class=line>--with-png-dir</span><br><span class=line></span><br><span class=line>注：上面的二选项的作用：处理 jpeg、png 图片的、php 可以动态生成 jpeg 图片</span><br><span class=line></span><br><span class=line>--with-zlib：是个压缩库、在互联网传输时用来压缩传输的</span><br><span class=line></span><br><span class=line>--with-libxml-dir=/usr：这个 libxml 是用来解析 xml 的、指定/usr 下</span><br><span class=line></span><br><span class=line>--enable-xml：支持 xml 的</span><br><span class=line></span><br><span class=line>--with-mhash：支持 mhash</span><br><span class=line></span><br><span class=line>--with-mcrypt=/usr/local/libmcrypt：libmcrypt-devel 这个程序包所指定的</span><br><span class=line></span><br><span class=line>--with-config-file-path=/etc：指定配置文件的存放路径的</span><br><span class=line></span><br><span class=line>--with-config-file-scan-dir=/etc/php.d：配置文件扫描路径</span><br><span class=line></span><br><span class=line>--with-bz2：支持 BZip2</span><br><span class=line></span><br><span class=line>为了支持 apache 的 worker 或 event 这两个 MPM，编译时使用了--enable-maintainer-zts 选项</span><br></pre></td></tr></table></figure><p>如果使用 PHP5.3 以上版本，为了链接 MySQL 数据库，可以指定 mysqlnd，这样在本机就不 需要先安装 MySQL 或 MySQL 开发包了。mysqlnd 从 php 5.3 开始可用，可以编译时绑定到它 （而不用和具体的 MySQL 客户端库绑定形成依赖），但从 PHP 5.4 开始它就是默认设置了</p><h6 id=3、提供php配置文件><a class=header-anchor href=#3、提供php配置文件>¶</a>3、提供php配置文件</h6><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver php-5.6.27]<span class=comment># cp php.ini-production /etc/php.ini</span></span><br></pre></td></tr></table></figure><h6 id=4、为php-fpm提供脚本><a class=header-anchor href=#4、为php-fpm提供脚本>¶</a>4、为php-fpm提供脚本</h6><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver php-5.6.27]<span class=comment># cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span></span><br><span class=line>[root@phpserver php-5.6.27]<span class=comment># chmod +x /etc/init.d/php-fpm </span></span><br><span class=line>[root@phpserver php-5.6.27]<span class=comment># chkconfig --add php-fpm</span></span><br><span class=line>[root@phpserver php-5.6.27]<span class=comment># chkconfig php-fpm on</span></span><br></pre></td></tr></table></figure><h6 id=5、提供php-fpm配置文件并编辑><a class=header-anchor href=#5、提供php-fpm配置文件并编辑>¶</a>5、提供php-fpm配置文件并编辑</h6><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># cp /usr/local/php5.6/etc/php-fpm.conf.default /usr/local/php5.6/etc/php-fpm.conf</span></span><br><span class=line>[root@phpserver ~]<span class=comment># vim /usr/local/php5.6/etc/php-fpm.conf</span></span><br><span class=line>修改内容如下：</span><br><span class=line>pid = run/php-fpm.pid</span><br><span class=line>listen = 192.168.1.50:9000</span><br><span class=line>pm.max_children = 50</span><br><span class=line>pm.start_servers = 5</span><br><span class=line>pm.min_spare_servers = 5</span><br><span class=line>pm.max_spare_servers = 35</span><br></pre></td></tr></table></figure><p>启动php-fpm</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># service php-fpm start</span></span><br><span class=line>Starting php-fpm  <span class=keyword>done</span></span><br><span class=line>[root@phpserver ~]<span class=comment># netstat -anpt | grep php-fpm</span></span><br><span class=line>tcp        0      0 192.168.1.50:9000       0.0.0.0:*               LISTEN      114068/php-fpm: mas</span><br><span class=line>[root@phpserver ~]<span class=comment># firewall-cmd --permanent --add-port=9000/tcp</span></span><br><span class=line>success</span><br><span class=line>[root@phpserver ~]<span class=comment># firewall-cmd --reload</span></span><br><span class=line>Success</span><br></pre></td></tr></table></figure><p>在该主机上新建虚拟主机目录用于存放网页文件</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># mkdir -p /var/www/benet</span></span><br></pre></td></tr></table></figure><p>至此 php 安装配置完毕，下面配置 apache 通过 fastcgi 协议调用 php</p><h6 id=6、配置-apache-切换到-apache-主机上操作><a class=header-anchor href=#6、配置-apache-切换到-apache-主机上操作>¶</a>6、配置 apache(切换到 apache 主机上操作)</h6><p>在 Apache2.4 以后已经专门有一个模块针对 FastCGI 的实现，此模块为 mod_proxy_fcgi.so， 它其实是作为 mod_proxy.so 模块的扩充，因此，这两个模块都要加载</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># vim /usr/local/http-2.4.23/conf/httpd.conf</span></span><br><span class=line>去掉一下注释</span><br><span class=line>LoadModule proxy_module modules/mod_proxy.so</span><br><span class=line>LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</span><br><span class=line>[root@apache ~]<span class=comment># apachectl restart</span></span><br><span class=line>[root@apache ~]<span class=comment># apachectl -M | grep proxy</span></span><br><span class=line> proxy_module (shared)</span><br><span class=line> proxy_fcgi_module (shared)</span><br></pre></td></tr></table></figure><p>建立一个目录作为虚拟主机的家目录</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># mkdir -p /var/www/benet</span></span><br></pre></td></tr></table></figure><p>编辑主配置文件 httpd.conf，开启虚拟主机</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># vim /usr/local/http-2.4.23/conf/httpd.conf</span></span><br><span class=line>启用 Include conf/extra/httpd-vhosts.conf</span><br><span class=line>Include conf/extra/httpd-vhosts.conf <span class=comment># 去掉注释</span></span><br><span class=line>同时定位 AddType；添加下面两行：让 apache 能识别 php 格式的页面</span><br><span class=line>    AddType application/x-httpd-php .php</span><br><span class=line>    AddType application/x-httpd-php-source .phps</span><br><span class=line>并且定位至 DirectoryIndex：支持 php 格式的主页</span><br><span class=line>&lt;IfModule dir_module&gt;</span><br><span class=line>    DirectoryIndex index.php index.html</span><br><span class=line>&lt;/IfModule&gt;</span><br><span class=line>添加 index.php（最好添加在最前面）</span><br></pre></td></tr></table></figure><p>配置虚拟主机支持使用 fcgi</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># vim /usr/local/http-2.4.23/conf/extra/httpd-vhosts.conf</span></span><br><span class=line>&lt;VirtualHost *:80&gt;</span><br><span class=line> ServerAdmin webmaster@benet.com</span><br><span class=line> DocumentRoot <span class=string>"/var/www/benet"</span></span><br><span class=line> ServerName www.benet.com</span><br><span class=line> ServerAlias benet.com</span><br><span class=line> ErrorLog <span class=string>"logs/benet.com-error_log"</span></span><br><span class=line> CustomLog <span class=string>"logs/benet.com-access_log"</span> common</span><br><span class=line> ProxyRequests Off</span><br><span class=line>ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://192.168.1.50:9000/var/www/benet/<span class=variable>$1</span></span><br><span class=line> <span class=comment>#&lt;LocationMatch "^(.*\.php(/.*)?)$"&gt;</span></span><br><span class=line> <span class=comment># ProxyPass fcgi://192.168.1.50:9000/var/www/benet</span></span><br><span class=line> <span class=comment>#&lt;/LocationMatch&gt;</span></span><br><span class=line>&lt;Directory <span class=string>"/var/www/benet"</span>&gt;</span><br><span class=line> Options FollowSymLinks</span><br><span class=line> AllowOverride None</span><br><span class=line> Require all granted</span><br><span class=line>&lt;/Directory&gt;</span><br><span class=line>&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><p>其中：</p><figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre></td><td class=code><pre><span class=line>ProxyRequests off：关闭正向代理</span><br><span class=line></span><br><span class=line>ProxyPassMatch：把以.php 结尾的文件请求发送到 php-fpm 进程，php-fpm 至少需要知道运 行的目录和 URI，所以这里直接在 fcgi://192.168.31.141:9000 后指明了这两个参数，其它的 参数的传递已经被 mod_proxy_fcgi.so 进行了封装，不需要手动指定</span><br><span class=line></span><br><span class=line>特别注意的是，目录需要与中的 DocumentRoot 后的路径一致</span><br><span class=line></span><br><span class=line>ProxyPassMatch</span><br><span class=line></span><br><span class=line>只有满足特定正则模式的内容才会匹配并执行此规则，这里的模式是，^/(.*<span class=tag>\<span class=name>.</span></span>php(/.*)?)<span class=formula>$ 从网站（虚拟主机的根目录开始，匹配任何以 .php 结尾，或者在 .php 之后 紧跟一个 / 再跟别的内容的路径</span></span><br><span class=line><span class=formula></span></span><br><span class=line><span class=formula>^ (caret) 和 $</span> (dollar)标志要匹配的路径的开始和结束</span><br><span class=line></span><br><span class=line>( )括号里的内容可以用 <span class=formula>$1 来表示，以方便后面引用它</span></span><br><span class=line><span class=formula></span></span><br><span class=line><span class=formula>fcgi:// 192.168.1.50:9000 通过 mod_proxy_fcgi 来转发的代理，使用 fastCGI 协议，转到 PHP-FPM 监听的端口</span></span><br><span class=line><span class=formula></span></span><br><span class=line><span class=formula>/path/to/your/documentroot/</span></span><br><span class=line><span class=formula></span></span><br><span class=line><span class=formula>非常重要！必须与虚拟主机的路径匹配，且必须是对应 php 文件在操作系统中的绝对路径。 否则会找不到文件</span></span><br><span class=line><span class=formula></span></span><br><span class=line><span class=formula>$</span>1 可以从原始请求扩展成整个请求路径的变量，这里指代前面( ) 里面匹配的那个路径（uri）</span><br></pre></td></tr></table></figure><p>补充：</p><figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>Apache httpd 2.4 以前的版本中，要么把 PHP 作为 Apache 的模块运行，要么添加一个第 三方模块支持 PHP-FPM 实现</span><br></pre></td></tr></table></figure><h6 id=7、测试-LAMP-环境：><a class=header-anchor href=#7、测试-LAMP-环境：>¶</a>7、测试 LAMP 环境：</h6><p>在 mysql 主机上创建用于 php 服务器连接的 mysql 账户</p><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>mysql&gt; grant all on *.* to testuser@&#39;%&#39; identified by &#39;123&#39;;</span><br><span class=line>Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><p>注意防火墙要允许 mysql 连接</p><p>在 php 服务器上的/var/www/benet 目录下创建.php 的测试页：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># cat /var/www/benet/index.php </span></span><br><span class=line>&lt;?php</span><br><span class=line>phpinfo();</span><br><span class=line>?&gt;</span><br><span class=line>[root@phpserver ~]<span class=comment># cat /var/www/benet/test1.php </span></span><br><span class=line>&lt;?php</span><br><span class=line><span class=variable>$link</span>=mysql_connect(<span class=string>'192.168.1.40'</span>,<span class=string>'testuser'</span>,<span class=string>'123'</span>);</span><br><span class=line><span class=keyword>if</span> (<span class=variable>$link</span>)<span class=built_in>echo</span> <span class=string>"connection success......"</span>;</span><br><span class=line>mysql_close();</span><br><span class=line>?&gt;</span><br></pre></td></tr></table></figure><p>测试访问php测试页<br><img data-src="https://img-blog.csdnimg.cn/20200610184525405.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><br><img data-src=https://img-blog.csdnimg.cn/20200610184606798.png><br>看到上面两个测试页说明 apache、php、mysql 之间可以协同工作了</p><h4 id=二、压力测试><a class=header-anchor href=#二、压力测试>¶</a>二、压力测试</h4><p>网站性能压力测试是服务器网站性能调优过程中必不可缺少的一环。只有让服务器处在高压 情况下，才能真正体现出软件、硬件等各种设置不当所暴露出的问题</p><p>性能测试工具目前最常见的有以下几种：ab、http_load、webbench、siege。今天我们专门 来介绍 ab</p><p>ab 是 apache 自带的压力测试工具。ab 非常实用，它不仅可以对 apache 服务器进行网站访 问压力测试，也可以对或其它类型的服务器进行压力测试。比如 nginx、tomcat、IIS 等</p><p>下面我们开始介绍有关 ab 命令的使用：</p><ol><li>ab 的原理</li><li>ab 的安装</li><li>ab 参数说明</li><li>ab 性能指标</li><li>ab 实际使用</li><li>测试 nginx 性能</li></ol><h5 id=1）ab的原理><a class=header-anchor href=#1）ab的原理>¶</a>1）ab的原理</h5><p>ab 是 apachebench 命令的缩写</p><p>ab 的原理：</p><p>ab 命令会创建多个并发访问线程，模拟多个访问者同时对某一 URL 地址进行访 问。它的测试目标是基于 URL 的，因此，它既可以用来测试 apache 的负载压力，也可以测 试 nginx、lighthttp、tomcat、IIS 等其它 Web 服务器的压力</p><p>ab 命令对发出负载的计算机要求很低，它既不会占用很高 CPU，也不会占用很多内存。但 却会给目标服务器造成巨大的负载，其原理类似 CC 攻击。自己测试使用也需要注意，否则 一次上太多的负载。可能造成目标服务器资源耗完，严重时甚至导致死机</p><h5 id=2）ab的安装><a class=header-anchor href=#2）ab的安装>¶</a>2）ab的安装</h5><p>ab 的安装非常简单，如果是源码安装 apache 的话，那就更简单了。apache 安装完毕后 ab 命令存放在 apache 安装目录的 bin 目录下。如下：</p><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>&#x2F;usr&#x2F;local&#x2F;http-2.4.23&#x2F;bin&#x2F;ab</span><br></pre></td></tr></table></figure><p>如果 apache 是通过 yum 的 RPM 包方式安装的话，ab 命令默认存放在/usr/bin 目录下。如 下：</p><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>which ab</span><br></pre></td></tr></table></figure><p>注意：如果不想安装 apache 但是又想使用 ab 命令的话，我们可以直接安装 apache 的工具 包 httpd-tools。如下：</p><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>yum -y install httpd-tools</span><br></pre></td></tr></table></figure><p>查看 ab 是否安装成功，可以切换到上述目录下，使用 ab –V 命令进行检测。如下：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># /usr/local/http-2.4.23/bin/ab -V</span></span><br></pre></td></tr></table></figure><p>如果ab -V命令出错，可以export LD_LIBRARY_PATH=&quot;/usr/local/openssl/lib/&quot;，就可以了</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># export LD_LIBRARY_PATH="/usr/local/openssl/lib/"</span></span><br><span class=line>[root@apache ~]<span class=comment># ab -V</span></span><br><span class=line>This is ApacheBench, Version 2.3 &lt;<span class=variable>$Revision</span>: 1748469 $&gt;</span><br><span class=line>Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class=line>Licensed to The Apache Software Foundation, http://www.apache.org/</span><br></pre></td></tr></table></figure><h5 id=3）ab参数说明><a class=header-anchor href=#3）ab参数说明>¶</a>3）ab参数说明</h5><p>有关 ab 命令的使用，我们可以通过帮助命令进行查看。如下：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># ab --help</span></span><br></pre></td></tr></table></figure><p>下面我们对这些参数，进行相关说明。如下：</p><p>n：在测试会话中所执行的请求个数(即总请求数)</p><p>-c：一次产生的请求个数（即并发用户数）</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># ab -c 500 -n 10000 http://192.168.1.70/index.html</span></span><br><span class=line>This is ApacheBench, Version 2.3 &lt;<span class=variable>$Revision</span>: 1748469 $&gt;</span><br><span class=line>Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class=line>Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class=line></span><br><span class=line>Benchmarking 192.168.1.70 (be patient)</span><br><span class=line>Completed 1000 requests</span><br><span class=line>Completed 2000 requests</span><br><span class=line>Completed 3000 requests</span><br><span class=line>Completed 4000 requests</span><br><span class=line>Completed 5000 requests</span><br><span class=line>Completed 6000 requests</span><br><span class=line>Completed 7000 requests</span><br><span class=line>Completed 8000 requests</span><br><span class=line>Completed 9000 requests</span><br><span class=line>Completed 10000 requests</span><br><span class=line>Finished 10000 requests</span><br><span class=line></span><br><span class=line></span><br><span class=line>Server Software:        Apache</span><br><span class=line>Server Hostname:        192.168.1.70</span><br><span class=line>Server Port:            80</span><br><span class=line></span><br><span class=line>Document Path:          /index.html </span><br><span class=line>Document Length:        208 bytes </span><br><span class=line></span><br><span class=line>Concurrency Level:      500 </span><br><span class=line>Time taken <span class=keyword>for</span> tests:   25.787 seconds </span><br><span class=line>Complete requests:      10000 </span><br><span class=line>Failed requests:        4 </span><br><span class=line>   (Connect: 0, Receive: 0, Length: 4, Exceptions: 0)</span><br><span class=line>Non-2xx responses:      10000</span><br><span class=line>Total transferred:      3720000 bytes <span class=comment>#</span></span><br><span class=line>HTML transferred:       2080000 bytes </span><br><span class=line>Requests per second:    387.80 [<span class=comment>#/sec] (mean) </span></span><br><span class=line>Time per request:       1289.329 [ms] (mean) </span><br><span class=line>Time per request:       2.579 [ms] (mean, across all concurrent requests) </span><br><span class=line>Transfer rate:          140.88 [Kbytes/sec] received</span><br><span class=line></span><br><span class=line>Connection Times (ms)</span><br><span class=line>              min  mean[+/-sd] median   max</span><br><span class=line>Connect:        0    1  31.7      0    3008</span><br><span class=line>Processing:     2  302 1687.9      9   25773</span><br><span class=line>Waiting:        2  294 1641.2      9   25773</span><br><span class=line>Total:          6  303 1689.6      9   25781</span><br><span class=line></span><br><span class=line>Percentage of the requests served within a certain time (ms)</span><br><span class=line>  50%      9</span><br><span class=line>  66%     10</span><br><span class=line>  75%     10</span><br><span class=line>  80%     10</span><br><span class=line>  90%     11</span><br><span class=line>  95%    939</span><br><span class=line>  98%   6460</span><br><span class=line>  99%  12908</span><br><span class=line> 100%  25781 (longest request)</span><br></pre></td></tr></table></figure><p>Document Path: /index.html ：</p><blockquote><p>请求的资源</p></blockquote><p>Document Length: 208 bytes ：</p><blockquote><p>响应数据的正文长度</p></blockquote><p>Concurrency Level: 500 ：</p><blockquote><p>并发个数（并发用户数）</p></blockquote><p>Time taken for tests: 25.787 seconds ：</p><blockquote><p>所有这些请求处理完成所花费的时间</p></blockquote><p>Complete requests: 10000 ：</p><blockquote><p>完成请求数</p></blockquote><p>Failed requests: 4 ：</p><blockquote><p>失败的请求数</p></blockquote><p>Total transferred: 3720000 bytes ：</p><blockquote><p>表示所有请求的响应数据长度总和，包括每个 HTTP响应数据的头信息和正文数据的长度。注意这里不包括 HTTP 请求数据的长度，仅仅为 web服务器流向用户 PC 的应用层数据总长度</p></blockquote><p>HTML transferred: 2080000 bytes ：</p><blockquote><p>表示所有请求的响应数据中正文数据的总和，也就是减去了 Total transferred 中 HTTP 响应数据中的头信息的长度</p></blockquote><p>Requests per second: 387.80 [：/sec] (mean) ：</p><blockquote><p>吞吐量-每秒请求数</p><p>计算公式：Complete requests/Time taken for tests</p></blockquote><p>Time per request: 1289.329 [ms] (mean) ：</p><blockquote><p>用户平均请求等待时间</p><p>计算公式：Timetoken for tests/（Complete requests/Concurrency Level）</p></blockquote><p>Time per request: 2.579 [ms] (mean, across all concurrent requests) ：</p><blockquote><p>服务器平均请求等待时间</p><p>计算公式：Time taken for tests/Complete requests</p></blockquote><p>Transfer rate: 140.88 [Kbytes/sec] received</p><blockquote><p>表示这些请求在单位时间内从服务器获取的数据长度</p><p>计算公式：Total trnasferred/ Time taken for tests，这个统计很好的说明服务器的处理能力达到极限时，其出口宽带的需求量。（即平均每秒网络上的流量）</p></blockquote><figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line>Connection Times (ms)</span><br><span class=line>              min  mean[+/-sd] median   max</span><br><span class=line>Connect:        0    1  31.7      0    3008</span><br><span class=line>Processing:     2  302 1687.9      9   25773</span><br><span class=line>Waiting:        2  294 1641.2      9   25773</span><br><span class=line>Total:          6  303 1689.6      9   25781</span><br><span class=line></span><br><span class=line>Percentage of the requests served within a certain time (ms)</span><br><span class=line>  50<span class=comment>%      9</span></span><br><span class=line>  66<span class=comment>%     10</span></span><br><span class=line>  75<span class=comment>%     10</span></span><br><span class=line>  80<span class=comment>%     10</span></span><br><span class=line>  90<span class=comment>%     11</span></span><br><span class=line>  95<span class=comment>%    939</span></span><br><span class=line>  98<span class=comment>%   6460</span></span><br><span class=line>  99<span class=comment>%  12908</span></span><br><span class=line> 100<span class=comment>%  25781 (longest request)</span></span><br></pre></td></tr></table></figure><p>这部分数据用于描述每个请求处理时间的分布情况，比如以上测试，80%的请求处理时间 都不超过 66ms，这个处理时间是指前面的 Time per request，即对于单个用户而言，平均 每个请求的处理时间</p><h5 id=4）ab-性能指标><a class=header-anchor href=#4）ab-性能指标>¶</a>4）ab 性能指标</h5><p>在进行性能测试过程中有几个指标比较重要：</p><h6 id=1、吞吐率（Requests-per-second）><a class=header-anchor href=#1、吞吐率（Requests-per-second）>¶</a>1、吞吐率（Requests per second）</h6><p>服务器并发处理能力的量化描述，单位是 reqs/s，指的是在某个并发用户数下单位时间内处 理的请求数。某个并发用户数下单位时间内能处理的最大请求数，称之为最大吞吐率。 记住：吞吐率是基于并发用户数的。这句话代表了两个含义：</p><blockquote><p>a、吞吐率和并发用户数相关</p><p>b、不同的并发用户数下，吞吐率一般是不同的</p></blockquote><p>计算公式：总请求数/处理完成这些请求数所花费的时间，即：</p><p>Request per second=Complete requests/Time taken for tests</p><p>必须要说明的是，这个数值表示当前机器的整体性能，值越大越好</p><h6 id=2、并发连接数（The-number-of-concurrent-connections）><a class=header-anchor href=#2、并发连接数（The-number-of-concurrent-connections）>¶</a>2、并发连接数（The number of concurrent connections）</h6><p>并发连接数指的是某个时刻服务器所接受的请求数目，简单的讲，就是一个会话</p><h6 id=3、并发用户数（Concurrency-Level）><a class=header-anchor href=#3、并发用户数（Concurrency-Level）>¶</a>3、并发用户数（Concurrency Level）</h6><p>要注意区分这个概念和并发连接数之间的区别，一个用户可能同时会产生多个会话，也即连 接数</p><h6 id=4、用户平均请求等待时间（Time-per-request）><a class=header-anchor href=#4、用户平均请求等待时间（Time-per-request）>¶</a>4、用户平均请求等待时间（Time per request）</h6><p>计算公式：处理完成所有请求数所花费的时间/（总请求数/并发用户数），即：</p><p>Time per request=Time taken for tests/（Complete requests/Concurrency Level）</p><h6 id=5、服务器平均请求等待时间（Time-per-request-across-all-concurrent-requests）><a class=header-anchor href=#5、服务器平均请求等待时间（Time-per-request-across-all-concurrent-requests）>¶</a>5、服务器平均请求等待时间（Time per request:across all concurrent requests）</h6><p>计算公式：处理完成所有请求数所花费的时间/总请求数，即：</p><p>Time taken for/testsComplete requests</p><p>可以看到，它是吞吐率的倒数。同时，它也等于用户平均请求等待时间/并发用户数，即：Time per request/Concurrency Level</p><h4 id=三、php加速软件Xcache><a class=header-anchor href=#三、php加速软件Xcache>¶</a>三、php加速软件Xcache</h4><p>（在 php 主机上完成下面的操作)</p><p>说明：</p><p>php 安装目录：/usr/local/php5.6</p><p>php.ini 配置文件路径：/etc/php.ini</p><p>php 网页根目录：/var/www/benet</p><h5 id=1、安装xcache><a class=header-anchor href=#1、安装xcache>¶</a>1、安装xcache</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># wget http://xcache.lighttpd.net/pub/Releases/3.2.0/xcache-3.2.0.tar.gz</span></span><br><span class=line>[root@phpserver ~]<span class=comment># tar zxf xcache-3.2.0.tar.gz </span></span><br><span class=line>[root@phpserver ~]<span class=comment># cd xcache-3.2.0/</span></span><br><span class=line><span class=comment># 用 phpize 生成 configure 配置文件</span></span><br><span class=line>[root@phpserver xcache-3.2.0]<span class=comment># /usr/local/php5.6/bin/phpize</span></span><br><span class=line>[root@phpserver xcache-3.2.0]<span class=comment># ./configure --enable-xcache --enable-xcache-coverager \</span></span><br><span class=line>&gt;  --<span class=built_in>enable</span>-xcache-optimizer --with-php-config=/usr/<span class=built_in>local</span>/php5.6/bin/php-config</span><br><span class=line>[root@phpserver xcache-3.2.0]<span class=comment># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><p>安装完成后最后出现的目录要记住，后面会用到</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>Installing shared extensions:     /usr/<span class=built_in>local</span>/php5.6/lib/php/extensions/no-debug-non-zts-20131226/</span><br></pre></td></tr></table></figure><h5 id=2、创建-xcache-缓存文件><a class=header-anchor href=#2、创建-xcache-缓存文件>¶</a>2、创建 xcache 缓存文件</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver xcache-3.2.0]<span class=comment># touch /tmp/xcache</span></span><br><span class=line>[root@phpserver xcache-3.2.0]<span class=comment># chmod 777 /tmp/xcache</span></span><br></pre></td></tr></table></figure><h5 id=3、拷贝xcache-后台管理程序到网站根目录><a class=header-anchor href=#3、拷贝xcache-后台管理程序到网站根目录>¶</a>3、拷贝xcache 后台管理程序到网站根目录</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver xcache-3.2.0]<span class=comment># cp -r htdocs/ /var/www/benet/xcache</span></span><br></pre></td></tr></table></figure><h5 id=4、配置php支持xcache><a class=header-anchor href=#4、配置php支持xcache>¶</a>4、配置php支持xcache</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># vim /etc/php.ini</span></span><br><span class=line><span class=comment># 在最后添加以下内容</span></span><br><span class=line>[xcache-common]</span><br><span class=line>extension = /usr/<span class=built_in>local</span>/php5.6/lib/php/extensions/no-debug-non-zts-20131226/xcache.so <span class=comment># 这个路径就是之前保存的路径</span></span><br><span class=line>[xcache.admin]</span><br><span class=line>xcache.admin.enable_auth = Off</span><br><span class=line>[xcache]</span><br><span class=line>xcache.shm_scheme =<span class=string>"mmap"</span></span><br><span class=line>xcache.size=60M</span><br><span class=line>xcache.count =1</span><br><span class=line>xcache.slots =8K</span><br><span class=line>xcache.ttl=0</span><br><span class=line>xcache.gc_interval =0</span><br><span class=line>xcache.var_size=64M</span><br><span class=line>xcache.var_count =1</span><br><span class=line>xcache.var_slots =8K</span><br><span class=line>xcache.var_ttl=0</span><br><span class=line>xcache.var_maxttl=0</span><br><span class=line>xcache.var_gc_interval =300</span><br><span class=line>xcache.test =Off</span><br><span class=line>xcache.readonly_protection = Off</span><br><span class=line>xcache.mmap_path =<span class=string>"/tmp/xcache"</span></span><br><span class=line>xcache.coredump_directory =<span class=string>""</span></span><br><span class=line>xcache.cacher =On</span><br><span class=line>xcache.stat=On</span><br><span class=line>xcache.optimizer =Off</span><br><span class=line>[xcache.coverager]</span><br><span class=line>xcache.coverager =On</span><br><span class=line>xcache.coveragedump_directory =<span class=string>""</span></span><br></pre></td></tr></table></figure><p>将 xcache 目录拷贝到 apache 主机的网页文档目录下</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># scp -r /var/www/benet/xcache/ root@192.168.1.70:/var/www/benet/</span></span><br></pre></td></tr></table></figure><h5 id=5、测试><a class=header-anchor href=#5、测试>¶</a>5、测试</h5><p>重启 php-fpm</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># service php-fpm restart</span></span><br></pre></td></tr></table></figure><p>浏览器打开网站根目录下面的 xcache</p><p>192.168.1.70/xcache可以看到如下页面：<br><img data-src="https://img-blog.csdnimg.cn/20200610184657790.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"></p><p>至此，Linux 下安装 php 加速软件 Xcache 教程完成</p><p>执行 ab 压力测试：</p><p>执行第一次压力测试：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># ab -c 100 -n 1000 http://192.168.1.70/index.php</span></span><br><span class=line>This is ApacheBench, Version 2.3 &lt;<span class=variable>$Revision</span>: 1748469 $&gt;</span><br><span class=line>Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class=line>Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class=line></span><br><span class=line>Benchmarking 192.168.1.70 (be patient)</span><br><span class=line>Completed 100 requests</span><br><span class=line>Completed 200 requests</span><br><span class=line>Completed 300 requests</span><br><span class=line>Completed 400 requests</span><br><span class=line>Completed 500 requests</span><br><span class=line>Completed 600 requests</span><br><span class=line>Completed 700 requests</span><br><span class=line>Completed 800 requests</span><br><span class=line>Completed 900 requests</span><br><span class=line>Completed 1000 requests</span><br><span class=line>Finished 1000 requests</span><br><span class=line></span><br><span class=line></span><br><span class=line>Server Software:        Apache</span><br><span class=line>Server Hostname:        192.168.1.70</span><br><span class=line>Server Port:            80</span><br><span class=line></span><br><span class=line>Document Path:          /index.php</span><br><span class=line>Document Length:        84474 bytes</span><br><span class=line></span><br><span class=line>Concurrency Level:      100</span><br><span class=line>Time taken <span class=keyword>for</span> tests:   1.464 seconds</span><br><span class=line>Complete requests:      1000</span><br><span class=line>Failed requests:        85</span><br><span class=line>   (Connect: 0, Receive: 0, Length: 85, Exceptions: 0)</span><br><span class=line>Total transferred:      84719909 bytes</span><br><span class=line>HTML transferred:       84473909 bytes</span><br><span class=line>Requests per second:    683.19 [<span class=comment>#/sec] (mean)</span></span><br><span class=line>Time per request:       146.373 [ms] (mean)</span><br><span class=line>Time per request:       1.464 [ms] (mean, across all concurrent requests)</span><br><span class=line>Transfer rate:          56523.11 [Kbytes/sec] received</span><br><span class=line></span><br><span class=line>Connection Times (ms)</span><br><span class=line>              min  mean[+/-sd] median   max</span><br><span class=line>Connect:        0    0   0.6      0       2</span><br><span class=line>Processing:    23  139  21.1    143     192</span><br><span class=line>Waiting:        9  135  20.9    138     157</span><br><span class=line>Total:         25  140  20.6    143     192</span><br><span class=line></span><br><span class=line>Percentage of the requests served within a certain time (ms)</span><br><span class=line>  50%    143</span><br><span class=line>  66%    145</span><br><span class=line>  75%    147</span><br><span class=line>  80%    148</span><br><span class=line>  90%    152</span><br><span class=line>  95%    157</span><br><span class=line>  98%    160</span><br><span class=line>  99%    161</span><br><span class=line> 100%    192 (longest request)</span><br></pre></td></tr></table></figure><p>执行第二次压力测试</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br></pre></td><td class=code><pre><span class=line>[root@apache ~]<span class=comment># ab -c 100 -n 1000 http://192.168.1.70/index.php</span></span><br><span class=line>This is ApacheBench, Version 2.3 &lt;<span class=variable>$Revision</span>: 1748469 $&gt;</span><br><span class=line>Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class=line>Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class=line></span><br><span class=line>Benchmarking 192.168.1.70 (be patient)</span><br><span class=line>Completed 100 requests</span><br><span class=line>Completed 200 requests</span><br><span class=line>Completed 300 requests</span><br><span class=line>Completed 400 requests</span><br><span class=line>Completed 500 requests</span><br><span class=line>Completed 600 requests</span><br><span class=line>Completed 700 requests</span><br><span class=line>Completed 800 requests</span><br><span class=line>Completed 900 requests</span><br><span class=line>Completed 1000 requests</span><br><span class=line>Finished 1000 requests</span><br><span class=line></span><br><span class=line></span><br><span class=line>Server Software:        Apache</span><br><span class=line>Server Hostname:        192.168.1.70</span><br><span class=line>Server Port:            80</span><br><span class=line></span><br><span class=line>Document Path:          /index.php</span><br><span class=line>Document Length:        84474 bytes</span><br><span class=line></span><br><span class=line>Concurrency Level:      100</span><br><span class=line>Time taken <span class=keyword>for</span> tests:   1.510 seconds</span><br><span class=line>Complete requests:      1000</span><br><span class=line>Failed requests:        101</span><br><span class=line>   (Connect: 0, Receive: 0, Length: 101, Exceptions: 0)</span><br><span class=line>Total transferred:      84719889 bytes</span><br><span class=line>HTML transferred:       84473889 bytes</span><br><span class=line>Requests per second:    662.27 [<span class=comment>#/sec] (mean)</span></span><br><span class=line>Time per request:       150.995 [ms] (mean)</span><br><span class=line>Time per request:       1.510 [ms] (mean, across all concurrent requests)</span><br><span class=line>Transfer rate:          54792.57 [Kbytes/sec] received</span><br><span class=line></span><br><span class=line>Connection Times (ms)</span><br><span class=line>              min  mean[+/-sd] median   max</span><br><span class=line>Connect:        0    0   0.3      0       2</span><br><span class=line>Processing:     8  144  24.0    150     184</span><br><span class=line>Waiting:        4  137  23.6    143     155</span><br><span class=line>Total:          9  144  23.7    150     184</span><br><span class=line></span><br><span class=line>Percentage of the requests served within a certain time (ms)</span><br><span class=line>  50%    150</span><br><span class=line>  66%    152</span><br><span class=line>  75%    152</span><br><span class=line>  80%    153</span><br><span class=line>  90%    155</span><br><span class=line>  95%    157</span><br><span class=line>  98%    158</span><br><span class=line>  99%    160</span><br><span class=line> 100%    184 (longest request)</span><br></pre></td></tr></table></figure><p>查看 xcache 的命中率：<br><img data-src="https://img-blog.csdnimg.cn/20200610184715159.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"></p><h4 id=四、部署bbs论坛><a class=header-anchor href=#四、部署bbs论坛>¶</a>四、部署bbs论坛</h4><h5 id=1、Discuz-的程序文件解压，并且将-upload-中所有文件放置到网站目录-php-服务器的操作><a class=header-anchor href=#1、Discuz-的程序文件解压，并且将-upload-中所有文件放置到网站目录-php-服务器的操作>¶</a>1、Discuz 的程序文件解压，并且将 upload 中所有文件放置到网站目录(php 服务器的操作)</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># mkdir discus</span></span><br><span class=line>[root@phpserver ~]<span class=comment># unzip Discuz_7.0.0_FULL_SC_UTF8.zip -d discus</span></span><br><span class=line>[root@phpserver ~]<span class=comment># mv discus/Discuz_7.0.0_FULL_SC_UTF8/upload/ /var/www/benet/bbs</span></span><br></pre></td></tr></table></figure><h5 id=2、设置-php-fpm-的服务用户为下面文件的属主或者对其设置写权限，否则安装时会报错><a class=header-anchor href=#2、设置-php-fpm-的服务用户为下面文件的属主或者对其设置写权限，否则安装时会报错>¶</a>2、设置 php-fpm 的服务用户为下面文件的属主或者对其设置写权限，否则安装时会报错</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># chmod -R 777 /var/www/benet/bbs/</span></span><br></pre></td></tr></table></figure><h5 id=3、修改-php-ini-文件><a class=header-anchor href=#3、修改-php-ini-文件>¶</a>3、修改 php.ini 文件</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># vim  /etc/php.ini</span></span><br><span class=line>short_open_tag = On <span class=comment># 将Off改为On，否则程序无法正常运行</span></span><br></pre></td></tr></table></figure><h5 id=4、重启-php-fpm><a class=header-anchor href=#4、重启-php-fpm>¶</a>4、重启 php-fpm</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># service php-fpm restart</span></span><br></pre></td></tr></table></figure><h5 id=5、web-服务器也需要有静态文件><a class=header-anchor href=#5、web-服务器也需要有静态文件>¶</a>5、web 服务器也需要有静态文件</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># scp -r /var/www/benet/bbs/ root@192.168.1.70:/var/www/benet/</span></span><br></pre></td></tr></table></figure><h5 id=6、在数据库服务器上创建-bbs-数据库及授权帐户><a class=header-anchor href=#6、在数据库服务器上创建-bbs-数据库及授权帐户>¶</a>6、在数据库服务器上创建 bbs 数据库及授权帐户</h5><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line>mysql&gt; create database bbsdb;</span><br><span class=line>Query OK, 1 row affected (0.00 sec)</span><br><span class=line></span><br><span class=line>mysql&gt; grant all on bbsdb.* to runbbs@&#39;%&#39; identified by &#39;pwd@123&#39;;</span><br><span class=line>Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><p>置完成之后，输入 httd//192.168.1.70/bbs/install 即可安装<br><img data-src="https://img-blog.csdnimg.cn/20200610184748849.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"></p><p>填写数据库的相关信息，添加数据库服务器的地址和 MariaDB 创建的数据库和用户密码，而 后在设置 bbs 的管理员帐号密码就可以继续安装了<br><img data-src="https://img-blog.csdnimg.cn/20200610184803971.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><br><img data-src="https://img-blog.csdnimg.cn/20200610184819127.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"><br>出现上面这种情况是由于 php 服务器安装了 discuz 之后导致程序发生变化从而导致动态服 务器和静态服务器的程序不一致，只需要手动把 bbs 服务器的文件和 web 服务器进行一次 同步即可，如果想实现自动同步，需要使用其他服务，如 initory+rsync、sersync 等工具</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>[root@phpserver ~]<span class=comment># scp -r /var/www/benet/bbs/* root@192.168.1.70:/var/www/benet/bbs/</span></span><br></pre></td></tr></table></figure><p>动态服务器和静态服务器同步文件之后，再次访问 bbs 的网址就正常了<br><img data-src="https://img-blog.csdnimg.cn/20200610184950613.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70"></p></div><div><ul class=post-copyright><li class=post-copyright-author><strong>本文作者：</strong>Maisy</li><li class=post-copyright-link><strong>本文链接：</strong> <a href=https://pdxblog.top/Apache%E4%B9%8BFCGI%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2LAMP.html title=Apache之FCGI模式部署LAMP>https://pdxblog.top/Apache之FCGI模式部署LAMP.html</a></li><li class=post-copyright-license><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel=noopener target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class=post-footer><div class=post-tags><a href="/tags/%E6%9E%B6%E6%9E%84/" rel=tag># 架构</a></div><div class=post-nav><div class=post-nav-item><a href=/Apache%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%8C%96.html rel=prev title=Apache深度优化><i class="fa fa-chevron-left"></i> Apache深度优化</a></div><div class=post-nav-item><a href=/Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%84%E5%BB%BA.html rel=next title=Nginx反向代理缓存服务器构建>Nginx反向代理缓存服务器构建 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class=comments id=valine-comments></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class=nav><li class="nav-item nav-level-3"><a class=nav-link href=#FCGI模式编译安装-LAMP-xcache><span class=nav-number>1.</span> <span class=nav-text>¶FCGI模式编译安装 LAMP+xcache</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#一、编译安装-LAMP><span class=nav-number>1.1.</span> <span class=nav-text>¶一、编译安装 LAMP</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#FastCGI-方式安装-php><span class=nav-number>1.1.1.</span> <span class=nav-text>¶FastCGI 方式安装 php</span></a><ol class=nav-child><li class="nav-item nav-level-6"><a class=nav-link href=#1、解决依赖关系><span class=nav-number>1.1.1.1.</span> <span class=nav-text>¶1、解决依赖关系</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#2、编译安装php><span class=nav-number>1.1.1.2.</span> <span class=nav-text>¶2、编译安装php</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#3、提供php配置文件><span class=nav-number>1.1.1.3.</span> <span class=nav-text>¶3、提供php配置文件</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#4、为php-fpm提供脚本><span class=nav-number>1.1.1.4.</span> <span class=nav-text>¶4、为php-fpm提供脚本</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#5、提供php-fpm配置文件并编辑><span class=nav-number>1.1.1.5.</span> <span class=nav-text>¶5、提供php-fpm配置文件并编辑</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#6、配置-apache-切换到-apache-主机上操作><span class=nav-number>1.1.1.6.</span> <span class=nav-text>¶6、配置 apache(切换到 apache 主机上操作)</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#7、测试-LAMP-环境：><span class=nav-number>1.1.1.7.</span> <span class=nav-text>¶7、测试 LAMP 环境：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class=nav-link href=#二、压力测试><span class=nav-number>1.2.</span> <span class=nav-text>¶二、压力测试</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#1）ab的原理><span class=nav-number>1.2.1.</span> <span class=nav-text>¶1）ab的原理</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#2）ab的安装><span class=nav-number>1.2.2.</span> <span class=nav-text>¶2）ab的安装</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#3）ab参数说明><span class=nav-number>1.2.3.</span> <span class=nav-text>¶3）ab参数说明</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#4）ab-性能指标><span class=nav-number>1.2.4.</span> <span class=nav-text>¶4）ab 性能指标</span></a><ol class=nav-child><li class="nav-item nav-level-6"><a class=nav-link href=#1、吞吐率（Requests-per-second）><span class=nav-number>1.2.4.1.</span> <span class=nav-text>¶1、吞吐率（Requests per second）</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#2、并发连接数（The-number-of-concurrent-connections）><span class=nav-number>1.2.4.2.</span> <span class=nav-text>¶2、并发连接数（The number of concurrent connections）</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#3、并发用户数（Concurrency-Level）><span class=nav-number>1.2.4.3.</span> <span class=nav-text>¶3、并发用户数（Concurrency Level）</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#4、用户平均请求等待时间（Time-per-request）><span class=nav-number>1.2.4.4.</span> <span class=nav-text>¶4、用户平均请求等待时间（Time per request）</span></a></li><li class="nav-item nav-level-6"><a class=nav-link href=#5、服务器平均请求等待时间（Time-per-request-across-all-concurrent-requests）><span class=nav-number>1.2.4.5.</span> <span class=nav-text>¶5、服务器平均请求等待时间（Time per request:across all concurrent requests）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class=nav-link href=#三、php加速软件Xcache><span class=nav-number>1.3.</span> <span class=nav-text>¶三、php加速软件Xcache</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#1、安装xcache><span class=nav-number>1.3.1.</span> <span class=nav-text>¶1、安装xcache</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#2、创建-xcache-缓存文件><span class=nav-number>1.3.2.</span> <span class=nav-text>¶2、创建 xcache 缓存文件</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#3、拷贝xcache-后台管理程序到网站根目录><span class=nav-number>1.3.3.</span> <span class=nav-text>¶3、拷贝xcache 后台管理程序到网站根目录</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#4、配置php支持xcache><span class=nav-number>1.3.4.</span> <span class=nav-text>¶4、配置php支持xcache</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#5、测试><span class=nav-number>1.3.5.</span> <span class=nav-text>¶5、测试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class=nav-link href=#四、部署bbs论坛><span class=nav-number>1.4.</span> <span class=nav-text>¶四、部署bbs论坛</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#1、Discuz-的程序文件解压，并且将-upload-中所有文件放置到网站目录-php-服务器的操作><span class=nav-number>1.4.1.</span> <span class=nav-text>¶1、Discuz 的程序文件解压，并且将 upload 中所有文件放置到网站目录(php 服务器的操作)</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#2、设置-php-fpm-的服务用户为下面文件的属主或者对其设置写权限，否则安装时会报错><span class=nav-number>1.4.2.</span> <span class=nav-text>¶2、设置 php-fpm 的服务用户为下面文件的属主或者对其设置写权限，否则安装时会报错</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#3、修改-php-ini-文件><span class=nav-number>1.4.3.</span> <span class=nav-text>¶3、修改 php.ini 文件</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#4、重启-php-fpm><span class=nav-number>1.4.4.</span> <span class=nav-text>¶4、重启 php-fpm</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#5、web-服务器也需要有静态文件><span class=nav-number>1.4.5.</span> <span class=nav-text>¶5、web 服务器也需要有静态文件</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#6、在数据库服务器上创建-bbs-数据库及授权帐户><span class=nav-number>1.4.6.</span> <span class=nav-text>¶6、在数据库服务器上创建 bbs 数据库及授权帐户</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Maisy src=/images/author.jpg><p class=site-author-name itemprop=name>Maisy</p><div class=site-description itemprop=description>人的一生就是一个储蓄的过程，在奋斗的时候储存了希望；在耕耘的时候储存了一粒种子；在旅行的时候储存了风景；在微笑的时候储存了快乐。聪明的人善于储蓄，在漫长而短暂的人生旅途中，学会储蓄每一个闪光的瞬间，然后用它们酿成一杯美好的回忆，在四季的变幻与交替之间，散发浓香，珍藏一生</div></div><div class="site-state-wrap motion-element"><nav class=site-state><div class="site-state-item site-state-posts"><a href="/archives/"><span class=site-state-item-count>58</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class=site-state-item-count>6</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class=site-state-item-count>6</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/Gilbert2/Gilbert2.github.io title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Gilbert2&#x2F;Gilbert2.github.io" rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a></span> <span class=links-of-author-item><a href=https://blog.csdn.net/weixin_45636702 title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_45636702" rel=noopener target=_blank><i class="fab fa-crosshairs fa-fw"></i>CSDN</a></span></div><div class="cc-license motion-element" itemprop=license><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class=cc-opacity rel=noopener target=_blank><img src=/images/cc-by-nc-sa.svg alt="Creative Commons"></a></div></div></div></aside><div id=sidebar-dimmer></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; 2019 – <span itemprop=copyrightYear>2020</span> <span class=with-love><i class="fa fa-heart"></i></span> <span class=author itemprop=copyrightHolder>Maisy</span> <span class=post-meta-divider>|</span> <span class=post-meta-item-icon><i class="fa fa-chart-area"></i></span> <span class=post-meta-item-text>站点总字数：</span> <span title=站点总字数>391k</span> <span class=post-meta-divider>|</span> <span class=post-meta-item-icon><i class="fa fa-coffee"></i></span> <span class=post-meta-item-text>站点阅读时长 &asymp;</span> <span title=站点阅读时长>5:55</span></div><div class=powered-by>由 <a href="https://hexo.io/" class=theme-link rel=noopener target=_blank>Hexo</a> & <a href="https://muse.theme-next.org/" class=theme-link rel=noopener target=_blank>NexT.Muse</a> 强力驱动</div></div></footer></div><script src=/lib/anime.min.js></script><script src=//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js></script><script src=//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js></script><script src=//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js></script><script src=/lib/velocity/velocity.min.js></script><script src=/lib/velocity/velocity.ui.min.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/schemes/muse.js></script><script src=/js/next-boot.js></script><script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.3.9/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'yK6nF3Ng27WevBtHAbTkt8Jv-gzGzoHsz',
      appKey     : 'DXAxzx0igQL9KzyblmtXnVkh',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script></body></html>